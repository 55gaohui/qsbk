{"version":3,"sources":["webpack:///D:/studyPro/qsbk/main.js","webpack:///D:/studyPro/qsbk/pages/user-chat/user-chat.vue?65e1","webpack:///D:/studyPro/qsbk/pages/user-chat/user-chat.vue?f952","webpack:///D:/studyPro/qsbk/pages/user-chat/user-chat.vue?3fd0","webpack:///D:/studyPro/qsbk/pages/user-chat/user-chat.vue?abc1","webpack:///D:/studyPro/qsbk/pages/user-chat/user-chat.vue"],"names":["createPage","Page","name","components","userChatBottom","userChatList","data","scrollInto","style","contentH","itemH","list","loadtext","onLoad","e","userinfo","JSON","parse","userid","uni","showToast","title","icon","navigateBack","delta","$chat","CurrentToUser","userpic","username","setNavigationBarTitle","onUnload","onReady","__init","methods","getdata","pageToBottom","$on","push","__format","type","isme","olddata","lastIndex","length","isall","getStorageSync","User","id","i","gstime","time","gettime","getChatTime","splice","submit","result","send","$http","post","token","checkToken","checkAuth","err","res","errorCheck","console","log","loadmore"],"mappings":"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","file":"pages/user-chat/user-chat.js","sourcesContent":["import 'uni-pages';import '@dcloudio/uni-stat';\n\nimport Vue from 'vue'            \nimport Page from './pages/user-chat/user-chat.vue'\ncreatePage(Page)","import { render, staticRenderFns } from \"./user-chat.vue?vue&type=template&id=32739e23&\"\nimport script from \"./user-chat.vue?vue&type=script&lang=js&\"\nexport * from \"./user-chat.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../HBuilderX/plugins/uniapp-cli/node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\n/* hot reload */\nif (module.hot) {\n  var api = require(\"D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\vue-hot-reload-api\\\\dist\\\\index.js\")\n  api.install(require('vue'))\n  if (api.compatible) {\n    module.hot.accept()\n    if (!module.hot.data) {\n      api.createRecord('32739e23', component.options)\n    } else {\n      api.reload('32739e23', component.options)\n    }\n    module.hot.accept(\"./user-chat.vue?vue&type=template&id=32739e23&\", function () {\n      api.rerender('32739e23', {\n        render: render,\n        staticRenderFns: staticRenderFns\n      })\n    })\n  }\n}\ncomponent.options.__file = \"studyPro/qsbk/pages/user-chat/user-chat.vue\"\nexport default component.exports","export * from \"-!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-hbuilderx/packages/webpack-uni-nvue-loader/lib/templateLoader.js??vue-loader-options!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--17-0!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../HBuilderX/plugins/uniapp-cli/node_modules/vue-loader/lib/index.js??vue-loader-options!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-custom-block-loader/index.js??ref--0-1!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./user-chat.vue?vue&type=template&id=32739e23&\"","var render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns }","import mod from \"-!../../../../HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../HBuilderX/plugins/uniapp-cli/node_modules/vue-loader/lib/index.js??vue-loader-options!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-custom-block-loader/index.js??ref--0-1!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./user-chat.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../HBuilderX/plugins/uniapp-cli/node_modules/vue-loader/lib/index.js??vue-loader-options!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-custom-block-loader/index.js??ref--0-1!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./user-chat.vue?vue&type=script&lang=js&\"","//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport time from \"../../common/time.js\"\nimport userChatList from \"../../components/user-chat/user-chat-list.vue\"\nimport userChatBottom from \"../../components/user-chat/user-chat-bottom.vue\"\nexport default {\n\tname: \"user-chat\",\n\tcomponents: {\n\t\tuserChatBottom,\n\t\tuserChatList\n\t},\n\tdata() {\n\t\treturn {\n\t\t\tscrollInto: '',\n\t\t\tstyle: {\n\t\t\t\tcontentH:0,\n\t\t\t\titemH: 0\n\t\t\t},\n\t\t\tlist: [],\n\t\t\tloadtext: '点击加载更多'\n\t\t};\n\t},\n\tonLoad(e){\n\t\tlet userinfo = JSON.parse(e.userinfo);\n\t\t//用户不存在\n\t\tif(!userinfo.userid){\n\t\t\tuni.showToast({title:'该用户不存在',icon:'none'});\n\t\t\treturn uni.navigateBack({delta: 1});\n\t\t}\n\t\t//初始化聊天对象\n\t\tthis.$chat.CurrentToUser = {\n\t\t\tuserid: userinfo.userid,\n\t\t\tuserpic: userinfo.userpic,\n\t\t\tusername: userinfo.username\n\t\t}\n\t\t//修改标题\n\t\tuni.setNavigationBarTitle({title: userinfo.username});\n\t},\n\tonUnload(){\n\t\tthis.$chat.CurrentToUser = {\n\t\t\tuserid: 0,\n\t\t\tuserpic: '',\n\t\t\tusername: ''\n\t\t}\n\t},\n\tonReady() {\n\t\tthis.__init();\n\t},\n\tmethods: {\n\t\t// 初始化参数\n\t\t__init() {\n\t\t\t//获取聊天历史记录\n\t\t\tthis.getdata();\n\t\t\t//至于底部\n\t\t\tthis.pageToBottom();\n\t\t\t//开启监听\n\t\t\tuni.$on('UserChat',(data)=>{\n\t\t\t\tthis.list.push(this.$chat.__format(data,{\n\t\t\t\t\ttype:'chatdetail',\n\t\t\t\t\tisme:false,\n\t\t\t\t\tolddata: this.list\n\t\t\t\t}));\n\t\t\t\tthis.pageToBottom();\n\t\t\t})\n\t\t},\n\t\t//滚动到底部\n\t\tpageToBottom(){\n\t\t\tlet lastIndex = this.list.length - 1\n\t\t\tif (lastIndex < 0) return;\n\t\t\tthis.scrollInto = 'chat'+lastIndex\n\t\t},\n\t\t// 获取聊天数据\n\t\tgetdata(isall = false) {\n\t\t\ttry{\n\t\t\t\tlet list = uni.getStorageSync('chatdetail_'+this.User.userinfo.id+'_'+this.$chat.CurrentToUser.userid);\n\t\t\t\tlist = list ? JSON.parse(list) : [];\n\t\t\t\tfor (let i = 0; i < list.length; i++) {\n\t\t\t\t\tlist[i].gstime = time.gettime.getChatTime(list[i].time, i > 0 ? list[i - 1].time : 0);\n\t\t\t\t}\n\t\t\t\t// 首次加载十条\n\t\t\t\tif(!isall && list.length>10){\n\t\t\t\t\treturn this.list = list.splice(-10);\n\t\t\t\t}\n\t\t\t\t// 加载剩下的数据\n\t\t\t\tthis.list = list;\n\t\t\t\tthis.loadtext = '';\n\t\t\t}catch(e){\n\t\t\t\tuni.showToast({ title: '加载失败~', icon: 'none' });\n\t\t\t}\n\t\t\t\n\t\t},\n\t\tasync submit(data) {\n\t\t\tif (!data) {\n\t\t\t\treturn uni.showToast({ title: '请输入你要发送的消息~', icon: 'none' });\n\t\t\t}\n\t\t\tlet result = this.$chat.send({ type:'text',data:data });\n\t\t\tlet [err,res] = await this.$http.post('/chat/send',result,{\n\t\t\t\ttoken:true,\n\t\t\t\tcheckToken:true,\n\t\t\t\tcheckAuth:true\n\t\t\t});\n\t\t\tif (!this.$http.errorCheck(err,res)) {\n\t\t\t\treturn uni.showToast({\n\t\t\t\t\ttitle: '发送失败',icon:\"none\"\n\t\t\t\t});\n\t\t\t}\n\t\t\tthis.list.push(this.$chat.__format(result,{\n\t\t\t\ttype:\"chatdetail\", // 转化类型\n\t\t\t\tolddata:this.list,\n\t\t\t\tisme:true\n\t\t\t}));\n\t\t\tconsole.log(this.$chat.__format(result,{\n\t\t\t\ttype:\"chatdetail\", // 转化类型\n\t\t\t\tolddata:this.list,\n\t\t\t\tisme:true\n\t\t\t}));\n\t\t\tthis.pageToBottom();\n\t\t},\n\t\t// 加载更多\n\t\tloadmore(){\n\t\t\tif(this.loadtext!=\"点击加载更多\") return;\n\t\t\t// 修改状态\n\t\t\tthis.loadtext=\"加载中...\";\n\t\t\tthis.getdata(true);\n\t\t},\n\t}\n}\n"],"sourceRoot":""}